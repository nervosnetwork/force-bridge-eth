use super::*;
use ckb_testtool::context::Context;
use ckb_tool::ckb_types::{bytes::Bytes, core::TransactionBuilder, packed::*, prelude::*};
use force_eth_types::generated::basic;
use force_eth_types::generated::eth_bridge_lock_cell::ETHBridgeLockArgs;
use force_eth_types::generated::eth_bridge_type_cell::{ETHBridgeTypeArgs, ETHBridgeTypeData};

const MAX_CYCLES: u64 = 1_000_000_000;

#[test]
fn test_mint_mode_without_typescript() {
    // deploy contract
    let mut context = Context::default();

    // cell deps
    let bridge_lock: Bytes = Loader::default().load_binary("eth-bridge-lockscript");
    let bridge_lock_out_point = context.deploy_cell(bridge_lock);
    let bridge_lock_script_dep = CellDep::new_builder()
        .out_point(bridge_lock_out_point.clone())
        .build();
    let sudt_bin = include_bytes!("../../../offchain-modules/cli/deps/simple_udt");
    let sudt_outpoint = context.deploy_cell(sudt_bin.as_ref().into());
    let sudt_dep = CellDep::new_builder()
        .out_point(sudt_outpoint.clone())
        .build();

    // build input
    let bridge_lock_args = ETHBridgeLockArgs::new_builder().build();
    let bridge_lock_script = context
        .build_script(&bridge_lock_out_point, bridge_lock_args.as_bytes())
        .expect("script");
    let input_out_point = context.create_cell(
        CellOutput::new_builder()
            .capacity(1000u64.pack())
            .lock(bridge_lock_script.clone())
            .build(),
        Bytes::new(),
    );
    let input_outpoint_hex = hex::encode(input_out_point.as_slice());
    let input = CellInput::new_builder()
        .previous_output(input_out_point)
        .build();

    // build output
    let sudt_typescript = context
        .build_script(
            &sudt_outpoint,
            bridge_lock_script.calc_script_hash().as_bytes(),
        )
        .unwrap();
    let recipient_lockscript = Script::from_slice(&[
        73u8, 0, 0, 0, 16, 0, 0, 0, 48, 0, 0, 0, 49, 0, 0, 0, 155, 215, 224, 111, 62, 207, 75, 224,
        242, 252, 210, 24, 139, 35, 241, 185, 252, 200, 142, 93, 75, 101, 168, 99, 123, 23, 114,
        59, 189, 163, 204, 232, 1, 20, 0, 0, 0, 200, 50, 138, 171, 205, 155, 158, 142, 100, 251,
        197, 102, 196, 56, 92, 59, 222, 178, 25, 215,
    ])
    .unwrap();
    let outputs = vec![
        CellOutput::new_builder()
            .capacity(500u64.pack())
            .type_(Some(sudt_typescript.clone()).pack())
            .lock(recipient_lockscript)
            .build(),
        CellOutput::new_builder()
            .capacity(500u64.pack())
            .type_(Some(sudt_typescript).pack())
            .lock(Script::new_builder().build())
            .build(),
    ];
    let mut recipient_cell_data = 90u128.to_le_bytes().to_vec();
    recipient_cell_data.extend(b"sudt_extra_data");
    let outputs_data = vec![recipient_cell_data.pack(), 10u128.to_le_bytes().pack()];

    // build transaction
    let raw_witness = format!(
        "a112000010000000a1120000a11200008d1200008d1200001000000011000000881200000073120000731200001c000000240000006c020000740200000b07000029090000020000000000000044020000f9024194eab52f0d5c0f03c273372309b522a935f5b6ce12f863a0413055b58d692937cc2a7d80ca019c17e8d01175e58d11f157ae9124078b01d6a00000000000000000000000003dc3d2369b6d9879e593c3a133055e0f03a52a74a000000000000000000000000046beac96b726a51c5703f99ec787ce12793dae11b901c00000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000049490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000c8328aabcd9b9e8e64fbc566c4385c3bdeb219d700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024{}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f737564745f65787472615f64617461000000000000000000000000000000000083307832000000000000000093040000f904900182e4a1b9010000000000000000000000008000000040000000000000000000000000004000000000000000000000000004000000000000000000000000000000000028200000000000000000000100800008000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000020010000000000000000000000000000000400008000000008000000000000000000000000000020000000000000000000000000000010000000000000000000000000000000000000002000000000000000000000000000000000000000000000010000000000010000000000000000000000000400000000000000004000000000000000000f90386f89f943dc3d2369b6d9879e593c3a133055e0f03a52a74f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa000000000000000000000000046beac96b726a51c5703f99ec787ce12793dae11a0000000000000000000000000eab52f0d5c0f03c273372309b522a935f5b6ce12a0000000000000000000000000000000000000000000000000000000000000006483307830f89f943dc3d2369b6d9879e593c3a133055e0f03a52a74f863a08c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925a000000000000000000000000046beac96b726a51c5703f99ec787ce12793dae11a0000000000000000000000000eab52f0d5c0f03c273372309b522a935f5b6ce12a0ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9b83307831f9024194eab52f0d5c0f03c273372309b522a935f5b6ce12f863a0413055b58d692937cc2a7d80ca019c17e8d01175e58d11f157ae9124078b01d6a00000000000000000000000003dc3d2369b6d9879e593c3a133055e0f03a52a74a000000000000000000000000046beac96b726a51c5703f99ec787ce12793dae11b901c00000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000049490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000c8328aabcd9b9e8e64fbc566c4385c3bdeb219d700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024{}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f737564745f65787472615f646174610000000000000000000000000000000000833078321a020000f90217a0e8209e8ba120deca179d1c0f8248370e69594740303d715c82478ab688f98acaa01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d493479417c4b5ce0605f63732bfd175fece7ac6b4620fd2a03d00738996d0850df92e2779d19ec93ceec66691ba47fd4e0e6432c4b29c6578a02fdba7068f898f53d9a31eb668bae958abc936c4a442892c90a2c02a532b3fe0a0b42673154673a3e33a756ffb4972b681d3d9c2d1c329d19f1112bfa57df84223b90100000000000000000000000080000000400000000000000000000000000040000000000000000000000000040000000000000000000000000000000000282000000000000000000001008000080000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000200100000000000000000000000000000004000080000000080000000000000000000000000000200000000000000000000000000000100000000000000000000000000000000000000020000000000000000000000000000000000000000000000100000000000100000000000000000000000004000000000000000040000000000000000008307fdca82161e855c27f11e2382e4a1845fb378749ad98301090e846765746888676f312e31342e328664617277696ea0abfc66e238408a1c1a3e7e8ceee46e0f2018e87802765c5700c0afce457a47ea8811c9b892077fffba4a090000080000003e09000066393034396366393034393938323230383062393034393366393034393030313832653461316239303130303030303030303030303030303030303030303030303038303030303030303430303030303030303030303030303030303030303030303030303034303030303030303030303030303030303030303030303030303034303030303030303030303030303030303030303030303030303030303030303030303238323030303030303030303030303030303030303030313030383030303038303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303034303030303030303030303030303030303030303030303030303030303030303030303030303030303230303130303030303030303030303030303030303030303030303030303030303030343030303038303030303030303038303030303030303030303030303030303030303030303030303030303230303030303030303030303030303030303030303030303030303030303130303030303030303030303030303030303030303030303030303030303030303030303030303032303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303130303030303030303030303130303030303030303030303030303030303030303030303030343030303030303030303030303030303034303030303030303030303030303030303030663930333836663839663934336463336432333639623664393837396535393363336131333330353565306630336135326137346638363361306464663235326164316265326338396236396332623036386663333738646161393532626137663136336334613131363238663535613464663532336233656661303030303030303030303030303030303030303030303030303436626561633936623732366135316335373033663939656337383763653132373933646165313161303030303030303030303030303030303030303030303030306561623532663064356330663033633237333337323330396235323261393335663562366365313261303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030363438333330373833306638396639343364633364323336396236643938373965353933633361313333303535653066303361353261373466383633613038633562653165356562656337643562643134663731343237643165383466336464303331346330663762323239316535623230306163386337633362393235613030303030303030303030303030303030303030303030303034366265616339366237323661353163353730336639396563373837636531323739336461653131613030303030303030303030303030303030303030303030303065616235326630643563306630336332373333373233303962353232613933356635623663653132613066666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666663962383333303738333166393032343139346561623532663064356330663033633237333337323330396235323261393335663562366365313266383633613034313330353562353864363932393337636332613764383063613031396331376538643031313735653538643131663135376165393132343037386230316436613030303030303030303030303030303030303030303030303033646333643233363962366439383739653539336333613133333035356530663033613532613734613030303030303030303030303030303030303030303030303034366265616339366237323661353163353730336639396563373837636531323739336461653131623930316330303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303036343030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030306130303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030306130303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303132303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303031383030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303439343930303030303031303030303030303330303030303030333130303030303039626437653036663365636634626530663266636432313838623233663162396663633838653564346236356138363337623137373233626264613363636538303131343030303030306338333238616162636439623965386536346662633536366334333835633362646562323139643730303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303032343138666532353033346362633166363963353364663132663230383361323330393164326531383330623931316165383733323635663033646436316230303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030663733373536343734356636353738373437323631356636343631373436313030303030303030303030303030303030303030303030303030303030303030303038333330373833320100000000",
        &input_outpoint_hex,
        &input_outpoint_hex,
    );
    let witness = hex::decode(raw_witness).unwrap();
    dbg!(witness.len());
    let tx = TransactionBuilder::default()
        .cell_dep(sudt_dep)
        .cell_dep(bridge_lock_script_dep)
        .input(input)
        .outputs(outputs)
        .outputs_data(outputs_data)
        .witness(witness.pack())
        .build();
    // let tx = context.complete_tx(tx);

    // run
    let cycles = context
        .verify_tx(&tx, MAX_CYCLES)
        .expect("pass verification");
    println!("consume cycles: {}", cycles);
}

#[test]
fn test_mint_mode_with_typescript() {
    // deploy contract
    let mut context = Context::default();

    // cell deps
    let bridge_type: Bytes = Loader::default().load_binary("eth-bridge-typescript");
    let bridge_type_out_point = context.deploy_cell(bridge_type);
    let bridge_type_script_dep = CellDep::new_builder()
        .out_point(bridge_type_out_point.clone())
        .build();
    let bridge_lock: Bytes = Loader::default().load_binary("eth-bridge-lockscript");
    let bridge_lock_out_point = context.deploy_cell(bridge_lock);
    let bridge_lock_script_dep = CellDep::new_builder()
        .out_point(bridge_lock_out_point.clone())
        .build();
    let sudt_bin = include_bytes!("../../../offchain-modules/cli/deps/simple_udt");
    let sudt_outpoint = context.deploy_cell(sudt_bin.as_ref().into());
    let sudt_dep = CellDep::new_builder()
        .out_point(sudt_outpoint.clone())
        .build();

    // build input
    let recipient_lockscript = Script::from_slice(&[
        73u8, 0, 0, 0, 16, 0, 0, 0, 48, 0, 0, 0, 49, 0, 0, 0, 155, 215, 224, 111, 62, 207, 75, 224,
        242, 252, 210, 24, 139, 35, 241, 185, 252, 200, 142, 93, 75, 101, 168, 99, 123, 23, 114,
        59, 189, 163, 204, 232, 1, 20, 0, 0, 0, 200, 50, 138, 171, 205, 155, 158, 142, 100, 251,
        197, 102, 196, 56, 92, 59, 222, 178, 25, 215,
    ])
    .unwrap();
    dbg!(hex::encode(recipient_lockscript.as_slice()));
    let bridge_lock_args = ETHBridgeLockArgs::new_builder().build();
    let bridge_lock_script = context
        .build_script(&bridge_lock_out_point, bridge_lock_args.as_bytes())
        .expect("script");
    let bridge_type_args = ETHBridgeTypeArgs::new_builder()
        .bridge_lock_hash(
            basic::Byte32::from_slice(bridge_lock_script.calc_script_hash().as_slice()).unwrap(),
        )
        .recipient_lock_hash(
            basic::Byte32::from_slice(recipient_lockscript.calc_script_hash().as_slice()).unwrap(),
        )
        .build();
    let bridge_data = ETHBridgeTypeData::new_builder()
        .owner_lock_script(Script::new_builder().build().as_slice().to_vec().into())
        .fee(10.into())
        .build();
    let bridge_type_script = context
        .build_script(&bridge_type_out_point, bridge_type_args.as_bytes())
        .expect("script");
    let input_out_point = context.create_cell(
        CellOutput::new_builder()
            .capacity(1000u64.pack())
            .type_(Some(bridge_type_script).pack())
            .lock(bridge_lock_script.clone())
            .build(),
        bridge_data.as_bytes(),
    );
    let input_outpoint_hex = hex::encode(input_out_point.as_slice());
    let input = CellInput::new_builder()
        .previous_output(input_out_point)
        .build();

    // build output
    let sudt_typescript = context
        .build_script(
            &sudt_outpoint,
            bridge_lock_script.calc_script_hash().as_bytes(),
        )
        .unwrap();
    let outputs = vec![
        CellOutput::new_builder()
            .capacity(500u64.pack())
            .type_(Some(sudt_typescript.clone()).pack())
            .lock(recipient_lockscript)
            .build(),
        CellOutput::new_builder()
            .capacity(500u64.pack())
            .type_(Some(sudt_typescript).pack())
            .lock(Script::new_builder().build())
            .build(),
    ];
    let mut recipient_cell_data = 90u128.to_le_bytes().to_vec();
    recipient_cell_data.extend(b"sudt_extra_data");
    let outputs_data = vec![recipient_cell_data.pack(), 10u128.to_le_bytes().pack()];

    // build transaction
    let raw_witness = format!(
        "a112000010000000a1120000a11200008d1200008d1200001000000011000000881200000073120000731200001c000000240000006c020000740200000b07000029090000020000000000000044020000f9024194eab52f0d5c0f03c273372309b522a935f5b6ce12f863a0413055b58d692937cc2a7d80ca019c17e8d01175e58d11f157ae9124078b01d6a00000000000000000000000003dc3d2369b6d9879e593c3a133055e0f03a52a74a000000000000000000000000046beac96b726a51c5703f99ec787ce12793dae11b901c00000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000049490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000c8328aabcd9b9e8e64fbc566c4385c3bdeb219d700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024{}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f737564745f65787472615f64617461000000000000000000000000000000000083307832000000000000000093040000f904900182e4a1b9010000000000000000000000008000000040000000000000000000000000004000000000000000000000000004000000000000000000000000000000000028200000000000000000000100800008000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000020010000000000000000000000000000000400008000000008000000000000000000000000000020000000000000000000000000000010000000000000000000000000000000000000002000000000000000000000000000000000000000000000010000000000010000000000000000000000000400000000000000004000000000000000000f90386f89f943dc3d2369b6d9879e593c3a133055e0f03a52a74f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa000000000000000000000000046beac96b726a51c5703f99ec787ce12793dae11a0000000000000000000000000eab52f0d5c0f03c273372309b522a935f5b6ce12a0000000000000000000000000000000000000000000000000000000000000006483307830f89f943dc3d2369b6d9879e593c3a133055e0f03a52a74f863a08c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925a000000000000000000000000046beac96b726a51c5703f99ec787ce12793dae11a0000000000000000000000000eab52f0d5c0f03c273372309b522a935f5b6ce12a0ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9b83307831f9024194eab52f0d5c0f03c273372309b522a935f5b6ce12f863a0413055b58d692937cc2a7d80ca019c17e8d01175e58d11f157ae9124078b01d6a00000000000000000000000003dc3d2369b6d9879e593c3a133055e0f03a52a74a000000000000000000000000046beac96b726a51c5703f99ec787ce12793dae11b901c00000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000049490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000c8328aabcd9b9e8e64fbc566c4385c3bdeb219d700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024{}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f737564745f65787472615f646174610000000000000000000000000000000000833078321a020000f90217a0e8209e8ba120deca179d1c0f8248370e69594740303d715c82478ab688f98acaa01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d493479417c4b5ce0605f63732bfd175fece7ac6b4620fd2a03d00738996d0850df92e2779d19ec93ceec66691ba47fd4e0e6432c4b29c6578a02fdba7068f898f53d9a31eb668bae958abc936c4a442892c90a2c02a532b3fe0a0b42673154673a3e33a756ffb4972b681d3d9c2d1c329d19f1112bfa57df84223b90100000000000000000000000080000000400000000000000000000000000040000000000000000000000000040000000000000000000000000000000000282000000000000000000001008000080000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000200100000000000000000000000000000004000080000000080000000000000000000000000000200000000000000000000000000000100000000000000000000000000000000000000020000000000000000000000000000000000000000000000100000000000100000000000000000000000004000000000000000040000000000000000008307fdca82161e855c27f11e2382e4a1845fb378749ad98301090e846765746888676f312e31342e328664617277696ea0abfc66e238408a1c1a3e7e8ceee46e0f2018e87802765c5700c0afce457a47ea8811c9b892077fffba4a090000080000003e09000066393034396366393034393938323230383062393034393366393034393030313832653461316239303130303030303030303030303030303030303030303030303038303030303030303430303030303030303030303030303030303030303030303030303034303030303030303030303030303030303030303030303030303034303030303030303030303030303030303030303030303030303030303030303030303238323030303030303030303030303030303030303030313030383030303038303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303034303030303030303030303030303030303030303030303030303030303030303030303030303030303230303130303030303030303030303030303030303030303030303030303030303030343030303038303030303030303038303030303030303030303030303030303030303030303030303030303230303030303030303030303030303030303030303030303030303030303130303030303030303030303030303030303030303030303030303030303030303030303030303032303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303130303030303030303030303130303030303030303030303030303030303030303030303030343030303030303030303030303030303034303030303030303030303030303030303030663930333836663839663934336463336432333639623664393837396535393363336131333330353565306630336135326137346638363361306464663235326164316265326338396236396332623036386663333738646161393532626137663136336334613131363238663535613464663532336233656661303030303030303030303030303030303030303030303030303436626561633936623732366135316335373033663939656337383763653132373933646165313161303030303030303030303030303030303030303030303030306561623532663064356330663033633237333337323330396235323261393335663562366365313261303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030363438333330373833306638396639343364633364323336396236643938373965353933633361313333303535653066303361353261373466383633613038633562653165356562656337643562643134663731343237643165383466336464303331346330663762323239316535623230306163386337633362393235613030303030303030303030303030303030303030303030303034366265616339366237323661353163353730336639396563373837636531323739336461653131613030303030303030303030303030303030303030303030303065616235326630643563306630336332373333373233303962353232613933356635623663653132613066666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666663962383333303738333166393032343139346561623532663064356330663033633237333337323330396235323261393335663562366365313266383633613034313330353562353864363932393337636332613764383063613031396331376538643031313735653538643131663135376165393132343037386230316436613030303030303030303030303030303030303030303030303033646333643233363962366439383739653539336333613133333035356530663033613532613734613030303030303030303030303030303030303030303030303034366265616339366237323661353163353730336639396563373837636531323739336461653131623930316330303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303036343030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030306130303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030306130303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303132303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303031383030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303439343930303030303031303030303030303330303030303030333130303030303039626437653036663365636634626530663266636432313838623233663162396663633838653564346236356138363337623137373233626264613363636538303131343030303030306338333238616162636439623965386536346662633536366334333835633362646562323139643730303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303032343138666532353033346362633166363963353364663132663230383361323330393164326531383330623931316165383733323635663033646436316230303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030663733373536343734356636353738373437323631356636343631373436313030303030303030303030303030303030303030303030303030303030303030303038333330373833320100000000",
        &input_outpoint_hex,
        &input_outpoint_hex,
    );
    let witness = hex::decode(raw_witness).unwrap();
    dbg!(witness.len());
    let tx = TransactionBuilder::default()
        .cell_dep(bridge_lock_script_dep)
        .cell_dep(bridge_type_script_dep)
        .cell_dep(sudt_dep)
        .input(input)
        .outputs(outputs)
        .outputs_data(outputs_data)
        .witness(witness.pack())
        .build();
    // let tx = context.complete_tx(tx);

    // run
    let cycles = context
        .verify_tx(&tx, MAX_CYCLES)
        .expect("pass verification");
    println!("consume cycles: {}", cycles);
}
